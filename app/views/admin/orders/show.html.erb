<h1 class="page-header"><%=type_name @order%>订单</h1>

<% if notice.present? %>
<div class="alert alert-info" role="alert">
  <%= notice %>
</div>
<% end %>

<div>
  <% if !@order.delivered? and !@order.canceled? %>
    <%= form_tag admin_orders_cancel_url, method: :put, style: "display:inline-block" do %>
    <% submit_tag "取消订单", class: "btn btn-danger" %>
    <% end %>
  <% end %>
  <% if @order.paid? || (@order.offline_pay? && @order.placed?) %>
    <%= form_tag admin_orders_deliver_url, method: :put, style: "display:inline-block" do %>
      <% submit_tag "确认已处理", class: "btn btn-primary"%>
    <% end %>
  <% end %>
  <%= link_to admin_orders_url, class: "btn btn-primary" do %>
    <i class="glyphicon glyphicon-arrow-left"></i> 返回
  <% end %>
</div>
<div class="form-horizontal" style="padding-top:10px;">
  <div class="form-group">
    <label class="col-sm-2 control-label">订单编号</label>
    <div class="col-sm-9">
      <p class="form-control-static"><%= @order.order_id %></p>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">状态</label>
    <div class="col-sm-9">
      <p class="form-control-static"><%= order_status @order %></p>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">下订单时间</label>
    <div class="col-sm-9">
      <p class="form-control-static"><%= display_datetime @order.created_at %></p>
    </div>
  </div>

  <div class="form-group">
    <label class="col-sm-2 control-label">商品</label>
    <div class="col-sm-9">
      <table class="table">
        <thead>
          <tr>
            <th>项目</th><th class="number-align">数量</th><th class="number-align">单价</th>
          </tr>
        </thead>
        <tbody>
          <% @order.orders_products.each do |orders_products| %>
          <tr>
            <td><%= orders_products.product.name %></td>
            <td class="number-align"><%= orders_products.count %></td>
            <td class="number-align"><%= number_to_currency orders_products.count*orders_products.price, locale: :'zh-CN', precision: 2 %></td>
          </tr>
          <% end %>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="number-align">
              总价：<%= number_to_currency @order.subtotal, locale: :'zh-CN', precision: 2 %>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <% if @order.takeout? %>
  <div class="form-group">
    <label class="col-sm-2 control-label">配送地址</label>
    <div class="col-sm-9">
      <address>
        <div class="header">
          <span class="pull-left name"><%= @order.contact_name %></span>
          <span class="pull-right"><%= phone_number @order.contact_tel %></span>
        </div>
        <div><%= @order.contact_address %></div>
      </address>
    </div>
  </div>
  <% else %>
  <div class="form-group">
    <label class="col-sm-2 control-label">用餐人数</label>
    <div class="col-sm-9">
      <p class="form-control-static"><%=@order.person_count%>人</p>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">用餐时间</label>
    <div class="col-sm-9">
      <p class="form-control-static"><%=display_datetime @order.catering_time%></p>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">联系方式</label>
    <div class="col-sm-9">
      <p class="form-control-static"><%=@order.contact_tel%> &nbsp; <%=@order.contact_name%><%=@order.lady? ? "女士" : "先生"%></p>
    </div>
  </div>
  <% end %>

</div>
